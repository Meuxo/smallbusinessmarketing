<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Signup — Small Business Marketing System</title>
<style>
  :root{--accent:#0b5cff;--muted:#64748b}
  body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f8;margin:0;color:#0b1726}
  header{background:var(--accent);color:#fff;padding:1rem;text-align:center}
  .container{max-width:680px;margin:1.5rem auto;padding:1.25rem;background:#fff;border-radius:10px;box-shadow:0 8px 24px rgba(12,30,60,0.08)}
  h1,h2{margin:.25rem 0}
  form{margin-top:.5rem}
  label{display:block;font-weight:600;margin-top:.6rem}
  input,select{width:100%;padding:.55rem;border-radius:7px;border:1px solid #e6eef7;margin-top:.35rem;box-sizing:border-box}
  .row{display:flex;gap:.5rem}
  .btn{display:inline-block;padding:.55rem .9rem;border-radius:8px;border:0;background:var(--accent);color:#fff;cursor:pointer;font-weight:700;margin-top:.3rem}
  .btn.secondary{background:var(--muted)}
  .buttons{margin-top:.35rem;display:flex;gap:.5rem;align-items:center}
  #responseMessage{margin-top:.8rem;font-weight:700;color:green}
  .meta{font-size:.9rem;color:#475569;margin-top:.4rem}
  .links{margin-top:.6rem}
  a.link{color:var(--accent);text-decoration:none;font-weight:600}
  footer{max-width:680px;margin:0 auto;padding:0.8rem 1.25rem;text-align:center;color:#64748b;font-size:.9rem}
  canvas{margin-top:1rem;}
</style>
</head>
<body>
<header><h1>Small Business Marketing System</h1></header>

<main class="container">
  <h2>Customer Sign-Up</h2>
  <p class="meta">Enter your contact information to opt in to promotions and updates.</p>

  <form id="signupForm" onsubmit="return submitForm(event)" novalidate>
    <label for="name">Name</label>
    <input id="name" name="name" type="text" required autocomplete="name" />

    <label for="email">Email</label>
    <input id="email" name="email" type="email" required autocomplete="email" />

    <label for="phone">Phone</label>
    <input id="phone" name="phone" type="tel" placeholder="(555) 555-5555" />

    <div class="row">
      <div style="flex:1">
        <label for="birthday">Birthday</label>
        <input id="birthday" name="birthday" type="date" />
      </div>
      <div style="flex:1">
        <label for="interests">Interests</label>
        <select id="interests" name="interests">
          <option value="">-- Select Interest --</option>
          <option>Special Offers</option>
          <option>Events</option>
          <option>Merch</option>
          <option>News</option>
        </select>
      </div>
    </div>

    <label style="margin-top:.45rem"><input id="optin" name="optin" type="checkbox" /> I agree to receive promotional SMS messages.</label>

    <div class="buttons">
      <button class="btn" type="submit">Sign Up</button>
      <button class="btn secondary" type="button" onclick="clearForm()">Clear</button>
    </div>

    <div id="responseMessage" aria-live="polite"></div>
  </form>

  

</main>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const API_BASE = "http://localhost:3000";

function clearForm(){
  document.getElementById('signupForm').reset();
  document.getElementById('responseMessage').textContent = '';
}

async function submitForm(e){
  e.preventDefault();
  const btn = e.submitter || document.querySelector('.btn');
  btn.disabled = true;

  const payload = {
    name: document.getElementById('name').value.trim(),
    email: document.getElementById('email').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    birthday: document.getElementById('birthday').value || null,
    interests: document.getElementById('interests').value || null,
    optin: !!document.getElementById('optin').checked,
    date: new Date().toISOString().split('T')[0]  // For graph tracking
  };

  try {
    const r = await fetch(API_BASE + "/submit", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });

    if (!r.ok) throw new Error('Server error');

    document.getElementById('responseMessage').textContent = "Thanks — we've got your submission!";
    document.getElementById('responseMessage').style.color = "green";

    // clear form after short pause
    setTimeout(() => { clearForm(); loadChart(); }, 900);

  } catch (err) {
    console.error(err);
    document.getElementById('responseMessage').textContent = "Something went wrong. Please try again.";
    document.getElementById('responseMessage').style.color = "crimson";
  } finally {
    btn.disabled = false;
  }

  return false;
}

async function loadChart() {
  const res = await fetch(API_BASE + '/submissions');
  const data = await res.json();
  const counts = {};
  data.forEach(item => { counts[item.date] = (counts[item.date] || 0) + 1; });

  const ctx = document.getElementById('barChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: { labels: Object.keys(counts), datasets: [{ label: 'Signups', data: Object.values(counts), backgroundColor: 'skyblue' }] },
    options: { responsive:true }
  });
}

// Initial chart load
loadChart();
</script>
</body>
</html>
